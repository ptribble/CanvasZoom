function CanvasZoom(w,j,F,aa){var ak=256;var V="jpg";var E=true;var H=false;var ab=(H===false)?H:false;var W=0;var o=0;var T=-1;var ac=-1;var aj=0;var ai=0;var s=0;var q=0;var ag=0;var af=0;var i=false;var A=false;var h=0;var g=0;var c=1;var G="w";var O="h";var R="t";var z="wt";var Z=null;var m=null;var y=null;var K,ah,ad,I,v,D,t,U,S,L,J,b,n,l,x,B,p,e,f,d,r,u,Y,k,Q,X,M,a,C,P,N,ae;K=function(am,al,an){return j+"/"+am+"/"+al+"_"+an+"."+V};a=function(){var an=Z[ac];var ap=an.length;var aq=an[0].length;var am=0,ar=0;var ao=0;for(am=0;am<ap;am++){for(ar=0;ar<aq;ar++){an[am][ar][R]=m.getImageById(ao++)}}Z[T][0][0][R]=m.getImageById(ao);h=(w.width-an[G])/2;g=(w.height-an[O])/2;var al="mouse";w.addEventListener(al+"move",function(at){r(ah(at))},true);w.addEventListener(al+"down",function(at){k(ah(at))},true);w.addEventListener(al+"up",function(at){d(ah(at))},true);w.addEventListener("touchstart",function(at){b(ah(at))},false);w.addEventListener("touchend",function(at){n(ah(at))},false);w.addEventListener("touchmove",function(at){l(ah(at))},false);w.addEventListener("gestureend",function(at){x(ah(at))},false);w.addEventListener("gesturechange",function(at){B(ah(at))},true);w.addEventListener(al+"out",function(at){Q(ah(at))},true);w.addEventListener(al+"over",function(at){X(ah(at))},true);w.addEventListener("DOMMouseScroll",function(at){M(ah(at))},true);w.addEventListener(al+"wheel",function(at){M(ah(at))},true);window.addEventListener(al+"up",function(at){u(ah(at))},false);window.addEventListener(al+"move",function(at){Y(ah(at))},false);window.addEventListener("keypress",function(at){p(ah(at))},true);window.addEventListener("keydown",function(at){e(ah(at))},true);y=w.getContext("2d");ae()};ah=function(al){if(!al){al=window.event}return al};p=function(al){var am=al.charCode||al.keyCode;switch(am){case 37:f(-10,0);break;case 38:f(0,-10);break;case 39:f(10,0);break;case 40:f(0,10);break;case 36:ad(W,w.width/2,w.height/2);break;case 43:I(w.width/2,w.height/2);break;case 45:v(w.width/2,w.height/2);break}};e=function(al){var am=al.charCode||al.keyCode;switch(am){case 36:ad(W,w.width/2,w.height/2);ae();break}};k=function(al){i=true;A=false;s=U(al);q=S(al);ag=s;af=q};b=function(al){al.preventDefault();i=true;A=false;s=L(al);q=J(al);ag=s;af=q};d=function(al){i=false;A=false;aj=U(al);ai=S(al);if(aj===s&&ai===q){D()}};n=function(al){i=false;A=false;aj=L(al);ai=J(al);if(aj===s&&ai===q){D()}};r=function(an){aj=U(an);ai=S(an);if(i){var am=h+(aj-ag);var al=g+(ai-af);C(ac,am,al);ag=aj;af=ai;h=am;g=al;ae()}};l=function(an){an.preventDefault();an.stopPropagation();aj=L(an);ai=J(an);if(i){var am=h+(aj-ag);var al=g+(ai-af);C(ac,am,al);ag=aj;af=ai;h=am;g=al;ae()}};f=function(am,al){var ao=h+am;var an=g+al;C(ac,ao,an);ag=aj-am;af=ai-am;h=ao;g=an;ae()};x=function(al){c=1};B=function(al){al.preventDefault();var am=al.scale;if(am<0.75*c){t();c=am}if(am>1.25*c){D();c=am}};U=function(am){var al=0;if(am.layerX||am.layerX===0){al=am.layerX-w.offsetLeft}else{if(am.offsetX||am.offsetX===0){al=am.offsetX}}return al};S=function(al){var am=0;if(al.layerY||al.layerY===0){am=al.layerY-w.offsetTop}else{if(al.offsetY||al.offsetY===0){am=al.offsetY}}return am};L=function(am){var al=0;if(am.targetTouches[0]){al=am.targetTouches[0].pageX-w.offsetLeft}else{al=am.changedTouches[0].pageX-w.offsetLeft}return al};J=function(al){var am=0;if(al.targetTouches[0]){am=al.targetTouches[0].pageY-w.offsetTop}else{am=al.changedTouches[0].pageY-w.offsetTop}return am};Q=function(al){if(i){A=true}};X=function(al){A=false};M=function(al){var am=0;if(al.wheelDelta){am=-(al.wheelDelta/120)}else{if(al.detail){am=al.detail/3}}if(am){if(am<0){D()}else{t()}}if(al.preventDefault){al.preventDefault()}al.returnValue=false};u=function(al){if(i&&A){d(al)}};Y=function(al){if(i&&A){r(al)}};I=function(al,am){ad(ac+1,al,am);ae()};v=function(al,am){ad(ac-1,al,am);ae()};D=function(){I(aj,ai)};t=function(){v(aj,ai)};this.zoomInCentre=function(){I(w.width/2,w.height/2)};this.zoomOutCentre=function(){v(w.width/2,w.height/2)};ad=function(an,au,at){if(an>=W&&an<=o){var aq=an,av=ac,am=au-h,al=at-g;var ao=Z[aq][G]/Z[av][G];var ax=am*ao,aw=al*ao;var ar=h-(ax-am),ap=g-(aw-al);C(aq,ar,ap);ac=aq;h=ar;g=ap}};C=function(al,aD,aB){var aq=Z[al];var ax=-aD,aA=-aB;var an=ax+w.width,aC=aA+w.height;var ao=0,av=0,aE=0,ap=0;var aF=null;var at=aq[G],ar=aq[O];var am=aq.length,aw=aq[0].length;var az=0,au=0;var ay=[];for(az=0;az<am;az++){for(au=0;au<aw;au++){aF=aq[az][au];if(aF[R]===null&&aF[z]===false){ao=az*ak;av=ao+Math.min(ak,at-ao);aE=au*ak;ap=aE+Math.min(ak,ar-aE);if(!(ao>an||av<ax||aE>aC||ap<aA)){aF[z]=true;ay.push({name:al+"_"+az+"_"+au,file:K(al,az,au)})}}}}P(ay)};P=function(al){if(al.length>0){m=new ImageLoader({images:al,onImageLoaded:function(am,an){N(am,an)}})}};N=function(am,an){var ao=am.split("_");if(ao.length===3){var al=Z[ao[0]][ao[1]][ao[2]];al[R]=an;al[z]=false;ae()}};ae=function(){var aI=w.width,am=w.height,at=Z[ac];var an=at.length,aA=at[0].length,aE=-h,aG=-g;var ao=aE+aI,aH=aG+am;var ap=0,ax=0,aJ=0,aq=0,aD=0,aL=null;var av=at[G],au=at[O];var ar=g,al=h,aC=g+au,aB=h+av;y.clearRect(0,0,aI,ar+1);y.clearRect(0,ar,al+1,am-ar);y.clearRect(al+av-1,ar,aI-al-av,am-ar);y.clearRect(al,ar+au,av,am-ar-au);var aK=Z[T][0][0][R];var aF=0,aw=0;for(aF=0;aF<an;aF++){for(aw=0;aw<aA;aw++){ap=aF*ak;ax=ap+Math.min(ak,av-ap);aJ=aw*ak;aq=aJ+Math.min(ak,au-aJ);if(!(ap>ao||ax<aE||aJ>aH||aq<aG)){aL=at[aF][aw][R];ap+=h;ax+=h;aJ+=g;aq+=g;if(aL!==null){y.drawImage(aL,ap,aJ);if(H){y.strokeRect(ap,aJ,ak,ak);aD++}}else{if(!H||!ab){y.save();y.beginPath();y.moveTo(ap,aJ);y.lineTo(ax,aJ);y.lineTo(ax,aq);y.lineTo(ap,aq);y.closePath();y.clip();y.drawImage(aK,h,g,av,au);y.restore()}else{y.fillStyle="#999";y.fillRect(ap,aJ,ax-ap,aq-aJ)}}}}}if(E){y.strokeStyle="#000";y.strokeRect(0,0,aI,am)}if(H){y.strokeStyle="#ff0";y.strokeRect(aE,aG,ao-aE,aH-aG);y.strokeStyle="#f0f";y.strokeRect(al,ar,aB-al,aC-ar);y.fillStyle="#0f0";y.font="normal 12px Arial";y.fillText(aj+","+ai+" | "+h+","+g+" | "+aD,0,20);y.strokeStyle="#f00";var az,ay;for(ay=0;ay<am;ay+=ak){for(az=0;az<aI;az+=ak){y.strokeRect(az,ay,ak,ak)}}}};(function(){o=Math.ceil(Math.log(Math.max(F,aa))/Math.LN2);Z=[];var at=F;var av=aa;var ap=-1;var al=0,aq=0,ar=0;var ao=-1,au=-1;for(al=o;al>=W;al--){ao=Math.ceil(at/ak);au=Math.ceil(av/ak);if(T===-1&&at<=ak&&av<=ak){T=al}if(ap===-1&&at<=w.width&&av<=w.height){ap=al}Z[al]=[];for(aq=0;aq<ao;aq++){Z[al][aq]=[]}Z[al][G]=at;Z[al][O]=av;for(aq=0;aq<ao;aq++){for(ar=0;ar<au;ar++){Z[al][aq][ar]=[];Z[al][aq][ar][R]=null;Z[al][aq][ar][z]=false}}at/=2;av/=2}ac=ap;W=ap;var an=[];var am=0;ao=Z[ac].length;au=Z[ac][0].length;for(aq=0;aq<ao;aq++){for(ar=0;ar<au;ar++){an.push({id:am++,file:K(ac,aq,ar)})}}an.push({id:am,file:K(T,0,0)});m=new ImageLoader({images:an,onAllLoaded:function(){a()},})}())};