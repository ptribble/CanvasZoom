function CanvasZoom(p,f,w,O){var X=256;var J="jpg";var u=true;var K=0;var i=0;var H=-1;var P=-1;var W=0;var V=0;var l=0;var j=0;var T=0;var S=0;var e=false;var s=false;var d=0;var c=0;var x="w";var C="h";var F="t";var r="wt";var N=null;var h=null;var q=null;var z,U,Q,y,o,v,m,I,G,b,k,n,M,g,E,L,A,a,t,D,B,R;z=function(Z,Y,aa){return f+"/"+Z+"/"+Y+"_"+aa+"."+J};a=function(){var aa=N[P];var ac=aa.length;var ad=aa[0].length;var Z=0,ae=0;var ab=0;for(Z=0;Z<ac;Z++){for(ae=0;ae<ad;ae++){aa[Z][ae][F]=h.getImageById(ab++)}}N[H][0][0][F]=h.getImageById(ab);d=(p.width-aa[x])/2;c=(p.height-aa[C])/2;var Y="mouse";p.addEventListener(Y+"move",function(af){k(U(af))},true);p.addEventListener(Y+"down",function(af){g(U(af))},true);p.addEventListener(Y+"up",function(af){b(U(af))},true);p.addEventListener(Y+"out",function(af){E(U(af))},true);p.addEventListener(Y+"over",function(af){L(U(af))},true);p.addEventListener("DOMMouseScroll",function(af){A(U(af))},true);p.addEventListener(Y+"wheel",function(af){A(U(af))},true);window.addEventListener(Y+"up",function(af){n(U(af))},false);window.addEventListener(Y+"move",function(af){M(U(af))},false);q=p.getContext("2d");R()};U=function(Y){if(!Y){Y=window.event}return Y};g=function(Y){e=true;s=false;l=I(Y);j=G(Y);T=l;S=j};b=function(Y){e=false;s=false;W=I(Y);V=G(Y);if(W===l&&V===j){v()}};k=function(aa){W=I(aa);V=G(aa);if(e){var Z=d+(W-T);var Y=c+(V-S);t(P,Z,Y);T=W;S=V;d=Z;c=Y;R()}};I=function(Z){var Y=0;if(Z.layerX||Z.layerX===0){Y=Z.layerX-p.offsetLeft}else{if(Z.offsetX||Z.offsetX===0){Y=Z.offsetX}}return Y};G=function(Y){var Z=0;if(Y.layerY||Y.layerY===0){Z=Y.layerY-p.offsetTop}else{if(Y.offsetY||Y.offsetY===0){Z=Y.offsetY}}return Z};E=function(Y){if(e){s=true}};L=function(Y){s=false};A=function(Y){var Z=0;if(Y.wheelDelta){Z=-(Y.wheelDelta/120)}else{if(Y.detail){Z=Y.detail/3}}if(Z){if(Z<0){v()}else{m()}}if(Y.preventDefault){Y.preventDefault()}Y.returnValue=false};n=function(Y){if(e&&s){b(Y)}};M=function(Y){if(e&&s){k(Y)}};y=function(Y,Z){Q(P+1,Y,Z);R()};o=function(Y,Z){Q(P-1,Y,Z);R()};v=function(){y(W,V)};m=function(){o(W,V)};this.zoomInCentre=function(){y(p.width/2,p.height/2)};this.zoomOutCentre=function(){o(p.width/2,p.height/2)};Q=function(aa,ag,af){if(aa>=K&&aa<=i){var ad=aa,ah=P,Z=ag-d,Y=af-c;var ab=N[ad][x]/N[ah][x];var aj=Z*ab,ai=Y*ab;var ae=d-(aj-Z),ac=c-(ai-Y);t(ad,ae,ac);P=ad;d=ae;c=ac}};t=function(Y,ap,an){var ad=N[Y];var aj=-ap,am=-an;var aa=aj+p.width,ao=am+p.height;var ab=0,ah=0,aq=0,ac=0;var ar=null;var af=ad[x],ae=ad[C];var Z=ad.length,ai=ad[0].length;var al=0,ag=0;var ak=[];for(al=0;al<Z;al++){for(ag=0;ag<ai;ag++){ar=ad[al][ag];if(ar[F]===null&&ar[r]===false){ab=al*X;ah=ab+Math.min(X,af-ab);aq=ag*X;ac=aq+Math.min(X,ae-aq);if(!(ab>aa||ah<aj||aq>ao||ac<am)){ar[r]=true;ak.push({name:Y+"_"+al+"_"+ag,file:z(Y,al,ag)})}}}}D(ak)};D=function(Y){if(Y.length>0){h=new ImageLoader({images:Y,onImageLoaded:function(Z,aa){B(Z,aa)}})}};B=function(Z,aa){var ab=Z.split("_");if(ab.length===3){var Y=N[ab[0]][ab[1]][ab[2]];Y[F]=aa;Y[r]=false;R()}};R=function(){var at=p.width,Z=p.height,af=N[P];var aa=af.length,ak=af[0].length,ao=-d,aq=-c;var ab=ao+at,ar=aq+Z;var ac=0,aj=0,au=0,ad=0,an=0,aw=null;var ah=af[x],ag=af[C];var ae=c,Y=d,am=c+ag,al=d+ah;q.clearRect(0,0,at,ae);q.clearRect(0,ae,Y,Z-ae);q.clearRect(Y+ah,ae,at-Y-ah,Z-ae);q.clearRect(Y,ae+ag,ah,Z-ae-ag);var av=N[H][0][0][F];var ap=0,ai=0;for(ap=0;ap<aa;ap++){for(ai=0;ai<ak;ai++){ac=ap*X;aj=ac+Math.min(X,ah-ac);au=ai*X;ad=au+Math.min(X,ag-au);if(!(ac>ab||aj<ao||au>ar||ad<aq)){aw=af[ap][ai][F];ac+=d;aj+=d;au+=c;ad+=c;if(aw!==null){q.drawImage(aw,ac,au)}else{q.save();q.beginPath();q.moveTo(ac,au);q.lineTo(aj,au);q.lineTo(aj,ad);q.lineTo(ac,ad);q.closePath();q.clip();q.drawImage(av,d,c,ah,ag);q.restore()}}}}if(u){q.strokeStyle="#000";q.strokeRect(0,0,at,Z)}};(function(){i=Math.ceil(Math.log(Math.max(w,O))/Math.LN2);N=[];var af=w;var ah=O;var ac=-1;var Y=0,ad=0,ae=0;var ab=-1,ag=-1;for(Y=i;Y>=K;Y--){ab=Math.ceil(af/X);ag=Math.ceil(ah/X);if(H===-1&&af<=X&&ah<=X){H=Y}if(ac===-1&&af<=p.width&&ah<=p.height){ac=Y}N[Y]=[];for(ad=0;ad<ab;ad++){N[Y][ad]=[]}N[Y][x]=af;N[Y][C]=ah;for(ad=0;ad<ab;ad++){for(ae=0;ae<ag;ae++){N[Y][ad][ae]=[];N[Y][ad][ae][F]=null;N[Y][ad][ae][r]=false}}af/=2;ah/=2}P=ac;var aa=[];var Z=0;ab=N[P].length;ag=N[P][0].length;for(ad=0;ad<ab;ad++){for(ae=0;ae<ag;ae++){aa.push({id:Z++,file:z(P,ad,ae)})}}aa.push({id:Z,file:z(H,0,0)});h=new ImageLoader({images:aa,onAllLoaded:function(){a()},})}())};
