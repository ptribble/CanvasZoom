function CanvasZoom(s,g,z,U){var ae=256;var P="jpg";var y=true;var B=false;var V=(B===false)?B:false;var Q=0;var l=0;var N=-1;var W=-1;var ad=0;var ac=0;var o=0;var m=0;var aa=0;var Z=0;var f=false;var v=false;var e=0;var d=0;var A="w";var I="h";var L="t";var u="wt";var T=null;var j=null;var t=null;var E,ab,X,C,r,x,p,O,M,F,D,b,k,i,c,n,q,S,h,K,R,G,a,w,J,H,Y;E=function(ag,af,ah){return g+"/"+ag+"/"+af+"_"+ah+"."+P};a=function(){var ah=T[W];var aj=ah.length;var ak=ah[0].length;var ag=0,al=0;var ai=0;for(ag=0;ag<aj;ag++){for(al=0;al<ak;al++){ah[ag][al][L]=j.getImageById(ai++)}}T[N][0][0][L]=j.getImageById(ai);e=(s.width-ah[A])/2;d=(s.height-ah[I])/2;var af="mouse";s.addEventListener(af+"move",function(am){n(ab(am))},true);s.addEventListener(af+"down",function(am){h(ab(am))},true);s.addEventListener(af+"up",function(am){c(ab(am))},true);s.addEventListener("touchstart",function(am){b(ab(am))},false);s.addEventListener("touchend",function(am){k(ab(am))},false);s.addEventListener("touchmove",function(am){i(ab(am))},false);s.addEventListener(af+"out",function(am){K(ab(am))},true);s.addEventListener(af+"over",function(am){R(ab(am))},true);s.addEventListener("DOMMouseScroll",function(am){G(ab(am))},true);s.addEventListener(af+"wheel",function(am){G(ab(am))},true);window.addEventListener(af+"up",function(am){q(ab(am))},false);window.addEventListener(af+"move",function(am){S(ab(am))},false);t=s.getContext("2d");Y()};ab=function(af){if(!af){af=window.event}return af};h=function(af){f=true;v=false;o=O(af);m=M(af);aa=o;Z=m};b=function(af){af.preventDefault();f=true;v=false;o=F(af);m=D(af);aa=o;Z=m};c=function(af){f=false;v=false;ad=O(af);ac=M(af);if(ad===o&&ac===m){x()}};k=function(af){f=false;v=false;ad=F(af);ac=D(af);if(ad===o&&ac===m){x()}};n=function(ah){ad=O(ah);ac=M(ah);if(f){var ag=e+(ad-aa);var af=d+(ac-Z);w(W,ag,af);aa=ad;Z=ac;e=ag;d=af;Y()}};i=function(ah){ah.preventDefault();ah.stopPropagation();ad=F(ah);ac=D(ah);if(f){var ag=e+(ad-aa);var af=d+(ac-Z);w(W,ag,af);aa=ad;Z=ac;e=ag;d=af;Y()}};O=function(ag){var af=0;if(ag.layerX||ag.layerX===0){af=ag.layerX-s.offsetLeft}else{if(ag.offsetX||ag.offsetX===0){af=ag.offsetX}}return af};M=function(af){var ag=0;if(af.layerY||af.layerY===0){ag=af.layerY-s.offsetTop}else{if(af.offsetY||af.offsetY===0){ag=af.offsetY}}return ag};F=function(ag){var af=0;if(ag.targetTouches[0]){af=ag.targetTouches[0].pageX-s.offsetLeft}else{af=ag.changedTouches[0].pageX-s.offsetLeft}return af};D=function(af){var ag=0;if(af.targetTouches[0]){ag=af.targetTouches[0].pageY-s.offsetTop}else{ag=af.changedTouches[0].pageY-s.offsetTop}return ag};K=function(af){if(f){v=true}};R=function(af){v=false};G=function(af){var ag=0;if(af.wheelDelta){ag=-(af.wheelDelta/120)}else{if(af.detail){ag=af.detail/3}}if(ag){if(ag<0){x()}else{p()}}if(af.preventDefault){af.preventDefault()}af.returnValue=false};q=function(af){if(f&&v){c(af)}};S=function(af){if(f&&v){n(af)}};C=function(af,ag){X(W+1,af,ag);Y()};r=function(af,ag){X(W-1,af,ag);Y()};x=function(){C(ad,ac)};p=function(){r(ad,ac)};this.zoomInCentre=function(){C(s.width/2,s.height/2)};this.zoomOutCentre=function(){r(s.width/2,s.height/2)};X=function(ah,an,am){if(ah>=Q&&ah<=l){var ak=ah,ao=W,ag=an-e,af=am-d;var ai=T[ak][A]/T[ao][A];var aq=ag*ai,ap=af*ai;var al=e-(aq-ag),aj=d-(ap-af);w(ak,al,aj);W=ak;e=al;d=aj}};w=function(af,ax,av){var ak=T[af];var aq=-ax,au=-av;var ah=aq+s.width,aw=au+s.height;var ai=0,ao=0,ay=0,aj=0;var az=null;var am=ak[A],al=ak[I];var ag=ak.length,ap=ak[0].length;var at=0,an=0;var ar=[];for(at=0;at<ag;at++){for(an=0;an<ap;an++){az=ak[at][an];if(az[L]===null&&az[u]===false){ai=at*ae;ao=ai+Math.min(ae,am-ai);ay=an*ae;aj=ay+Math.min(ae,al-ay);if(!(ai>ah||ao<aq||ay>aw||aj<au)){az[u]=true;ar.push({name:af+"_"+at+"_"+an,file:E(af,at,an)})}}}}J(ar)};J=function(af){if(af.length>0){j=new ImageLoader({images:af,onImageLoaded:function(ag,ah){H(ag,ah)}})}};H=function(ag,ah){var ai=ag.split("_");if(ai.length===3){var af=T[ai[0]][ai[1]][ai[2]];af[L]=ah;af[u]=false;Y()}};Y=function(){var aC=s.width,ag=s.height,am=T[W];var ah=am.length,au=am[0].length,ay=-e,aA=-d;var ai=ay+aC,aB=aA+ag;var aj=0,aq=0,aD=0,ak=0,ax=0,aF=null;var ao=am[A],an=am[I];var al=d,af=e,aw=d+an,av=e+ao;t.clearRect(0,0,aC,al+1);t.clearRect(0,al,af+1,ag-al);t.clearRect(af+ao-1,al,aC-af-ao,ag-al);t.clearRect(af,al+an,ao,ag-al-an);var aE=T[N][0][0][L];var az=0,ap=0;for(az=0;az<ah;az++){for(ap=0;ap<au;ap++){aj=az*ae;aq=aj+Math.min(ae,ao-aj);aD=ap*ae;ak=aD+Math.min(ae,an-aD);if(!(aj>ai||aq<ay||aD>aB||ak<aA)){aF=am[az][ap][L];aj+=e;aq+=e;aD+=d;ak+=d;if(aF!==null){t.drawImage(aF,aj,aD);if(B){t.strokeRect(aj,aD,ae,ae);ax++}}else{if(!B||!V){t.save();t.beginPath();t.moveTo(aj,aD);t.lineTo(aq,aD);t.lineTo(aq,ak);t.lineTo(aj,ak);t.closePath();t.clip();t.drawImage(aE,e,d,ao,an);t.restore()}else{t.fillStyle="#999";t.fillRect(aj,aD,aq-aj,ak-aD)}}}}}if(y){t.strokeStyle="#000";t.strokeRect(0,0,aC,ag)}if(B){t.strokeStyle="#ff0";t.strokeRect(ay,aA,ai-ay,aB-aA);t.strokeStyle="#f0f";t.strokeRect(af,al,av-af,aw-al);t.fillStyle="#0f0";t.font="normal 12px Arial";t.fillText(ad+","+ac+" | "+e+","+d+" | "+ax,0,20);t.strokeStyle="#f00";var at,ar;for(ar=0;ar<ag;ar+=ae){for(at=0;at<aC;at+=ae){t.strokeRect(at,ar,ae,ae)}}}};(function(){l=Math.ceil(Math.log(Math.max(z,U))/Math.LN2);T=[];var am=z;var ao=U;var aj=-1;var af=0,ak=0,al=0;var ai=-1,an=-1;for(af=l;af>=Q;af--){ai=Math.ceil(am/ae);an=Math.ceil(ao/ae);if(N===-1&&am<=ae&&ao<=ae){N=af}if(aj===-1&&am<=s.width&&ao<=s.height){aj=af}T[af]=[];for(ak=0;ak<ai;ak++){T[af][ak]=[]}T[af][A]=am;T[af][I]=ao;for(ak=0;ak<ai;ak++){for(al=0;al<an;al++){T[af][ak][al]=[];T[af][ak][al][L]=null;T[af][ak][al][u]=false}}am/=2;ao/=2}W=aj;var ah=[];var ag=0;ai=T[W].length;an=T[W][0].length;for(ak=0;ak<ai;ak++){for(al=0;al<an;al++){ah.push({id:ag++,file:E(W,ak,al)})}}ah.push({id:ag,file:E(N,0,0)});j=new ImageLoader({images:ah,onAllLoaded:function(){a()},})}())};