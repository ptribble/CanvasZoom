function CanvasZoom(t,h,C,X){var ah=256;var S="jpg";var B=true;var E=false;var Y=(E===false)?E:false;var T=0;var m=0;var Q=-1;var Z=-1;var ag=0;var af=0;var p=0;var n=0;var ad=0;var ac=0;var g=false;var x=false;var f=0;var e=0;var c=1;var D="w";var L="h";var O="t";var w="wt";var W=null;var k=null;var v=null;var H,ae,aa,F,s,A,q,R,P,I,G,b,l,j,u,y,d,o,r,V,i,N,U,J,a,z,M,K,ab;H=function(aj,ai,ak){return h+"/"+aj+"/"+ai+"_"+ak+"."+S};a=function(){var ak=W[Z];var am=ak.length;var an=ak[0].length;var aj=0,ao=0;var al=0;for(aj=0;aj<am;aj++){for(ao=0;ao<an;ao++){ak[aj][ao][O]=k.getImageById(al++)}}W[Q][0][0][O]=k.getImageById(al);f=(t.width-ak[D])/2;e=(t.height-ak[L])/2;var ai="mouse";t.addEventListener(ai+"move",function(ap){o(ae(ap))},true);t.addEventListener(ai+"down",function(ap){i(ae(ap))},true);t.addEventListener(ai+"up",function(ap){d(ae(ap))},true);t.addEventListener("touchstart",function(ap){b(ae(ap))},false);t.addEventListener("touchend",function(ap){l(ae(ap))},false);t.addEventListener("touchmove",function(ap){j(ae(ap))},false);t.addEventListener("gestureend",function(ap){u(ae(ap))},false);t.addEventListener("gesturechange",function(ap){y(ae(ap))},true);t.addEventListener(ai+"out",function(ap){N(ae(ap))},true);t.addEventListener(ai+"over",function(ap){U(ae(ap))},true);t.addEventListener("DOMMouseScroll",function(ap){J(ae(ap))},true);t.addEventListener(ai+"wheel",function(ap){J(ae(ap))},true);window.addEventListener(ai+"up",function(ap){r(ae(ap))},false);window.addEventListener(ai+"move",function(ap){V(ae(ap))},false);v=t.getContext("2d");ab()};ae=function(ai){if(!ai){ai=window.event}return ai};i=function(ai){g=true;x=false;p=R(ai);n=P(ai);ad=p;ac=n};b=function(ai){ai.preventDefault();g=true;x=false;p=I(ai);n=G(ai);ad=p;ac=n};d=function(ai){g=false;x=false;ag=R(ai);af=P(ai);if(ag===p&&af===n){A()}};l=function(ai){g=false;x=false;ag=I(ai);af=G(ai);if(ag===p&&af===n){A()}};o=function(ak){ag=R(ak);af=P(ak);if(g){var aj=f+(ag-ad);var ai=e+(af-ac);z(Z,aj,ai);ad=ag;ac=af;f=aj;e=ai;ab()}};j=function(ak){ak.preventDefault();ak.stopPropagation();ag=I(ak);af=G(ak);if(g){var aj=f+(ag-ad);var ai=e+(af-ac);z(Z,aj,ai);ad=ag;ac=af;f=aj;e=ai;ab()}};u=function(ai){c=1};y=function(ai){ai.preventDefault();var aj=ai.scale;if(aj<0.75*c){q();c=aj}if(aj>1.25*c){A();c=aj}};R=function(aj){var ai=0;if(aj.layerX||aj.layerX===0){ai=aj.layerX-t.offsetLeft}else{if(aj.offsetX||aj.offsetX===0){ai=aj.offsetX}}return ai};P=function(ai){var aj=0;if(ai.layerY||ai.layerY===0){aj=ai.layerY-t.offsetTop}else{if(ai.offsetY||ai.offsetY===0){aj=ai.offsetY}}return aj};I=function(aj){var ai=0;if(aj.targetTouches[0]){ai=aj.targetTouches[0].pageX-t.offsetLeft}else{ai=aj.changedTouches[0].pageX-t.offsetLeft}return ai};G=function(ai){var aj=0;if(ai.targetTouches[0]){aj=ai.targetTouches[0].pageY-t.offsetTop}else{aj=ai.changedTouches[0].pageY-t.offsetTop}return aj};N=function(ai){if(g){x=true}};U=function(ai){x=false};J=function(ai){var aj=0;if(ai.wheelDelta){aj=-(ai.wheelDelta/120)}else{if(ai.detail){aj=ai.detail/3}}if(aj){if(aj<0){A()}else{q()}}if(ai.preventDefault){ai.preventDefault()}ai.returnValue=false};r=function(ai){if(g&&x){d(ai)}};V=function(ai){if(g&&x){o(ai)}};F=function(ai,aj){aa(Z+1,ai,aj);ab()};s=function(ai,aj){aa(Z-1,ai,aj);ab()};A=function(){F(ag,af)};q=function(){s(ag,af)};this.zoomInCentre=function(){F(t.width/2,t.height/2)};this.zoomOutCentre=function(){s(t.width/2,t.height/2)};aa=function(ak,aq,ap){if(ak>=T&&ak<=m){var an=ak,ar=Z,aj=aq-f,ai=ap-e;var al=W[an][D]/W[ar][D];var au=aj*al,at=ai*al;var ao=f-(au-aj),am=e-(at-ai);z(an,ao,am);Z=an;f=ao;e=am}};z=function(ai,aA,ay){var an=W[ai];var au=-aA,ax=-ay;var ak=au+t.width,az=ax+t.height;var al=0,ar=0,aB=0,am=0;var aC=null;var ap=an[D],ao=an[L];var aj=an.length,at=an[0].length;var aw=0,aq=0;var av=[];for(aw=0;aw<aj;aw++){for(aq=0;aq<at;aq++){aC=an[aw][aq];if(aC[O]===null&&aC[w]===false){al=aw*ah;ar=al+Math.min(ah,ap-al);aB=aq*ah;am=aB+Math.min(ah,ao-aB);if(!(al>ak||ar<au||aB>az||am<ax)){aC[w]=true;av.push({name:ai+"_"+aw+"_"+aq,file:H(ai,aw,aq)})}}}}M(av)};M=function(ai){if(ai.length>0){k=new ImageLoader({images:ai,onImageLoaded:function(aj,ak){K(aj,ak)}})}};K=function(aj,ak){var al=aj.split("_");if(al.length===3){var ai=W[al[0]][al[1]][al[2]];ai[O]=ak;ai[w]=false;ab()}};ab=function(){var aF=t.width,aj=t.height,ap=W[Z];var ak=ap.length,ax=ap[0].length,aB=-f,aD=-e;var al=aB+aF,aE=aD+aj;var am=0,au=0,aG=0,an=0,aA=0,aI=null;var ar=ap[D],aq=ap[L];var ao=e,ai=f,az=e+aq,ay=f+ar;v.clearRect(0,0,aF,ao+1);v.clearRect(0,ao,ai+1,aj-ao);v.clearRect(ai+ar-1,ao,aF-ai-ar,aj-ao);v.clearRect(ai,ao+aq,ar,aj-ao-aq);var aH=W[Q][0][0][O];var aC=0,at=0;for(aC=0;aC<ak;aC++){for(at=0;at<ax;at++){am=aC*ah;au=am+Math.min(ah,ar-am);aG=at*ah;an=aG+Math.min(ah,aq-aG);if(!(am>al||au<aB||aG>aE||an<aD)){aI=ap[aC][at][O];am+=f;au+=f;aG+=e;an+=e;if(aI!==null){v.drawImage(aI,am,aG);if(E){v.strokeRect(am,aG,ah,ah);aA++}}else{if(!E||!Y){v.save();v.beginPath();v.moveTo(am,aG);v.lineTo(au,aG);v.lineTo(au,an);v.lineTo(am,an);v.closePath();v.clip();v.drawImage(aH,f,e,ar,aq);v.restore()}else{v.fillStyle="#999";v.fillRect(am,aG,au-am,an-aG)}}}}}if(B){v.strokeStyle="#000";v.strokeRect(0,0,aF,aj)}if(E){v.strokeStyle="#ff0";v.strokeRect(aB,aD,al-aB,aE-aD);v.strokeStyle="#f0f";v.strokeRect(ai,ao,ay-ai,az-ao);v.fillStyle="#0f0";v.font="normal 12px Arial";v.fillText(ag+","+af+" | "+f+","+e+" | "+aA,0,20);v.strokeStyle="#f00";var aw,av;for(av=0;av<aj;av+=ah){for(aw=0;aw<aF;aw+=ah){v.strokeRect(aw,av,ah,ah)}}}};(function(){m=Math.ceil(Math.log(Math.max(C,X))/Math.LN2);W=[];var ap=C;var ar=X;var am=-1;var ai=0,an=0,ao=0;var al=-1,aq=-1;for(ai=m;ai>=T;ai--){al=Math.ceil(ap/ah);aq=Math.ceil(ar/ah);if(Q===-1&&ap<=ah&&ar<=ah){Q=ai}if(am===-1&&ap<=t.width&&ar<=t.height){am=ai}W[ai]=[];for(an=0;an<al;an++){W[ai][an]=[]}W[ai][D]=ap;W[ai][L]=ar;for(an=0;an<al;an++){for(ao=0;ao<aq;ao++){W[ai][an][ao]=[];W[ai][an][ao][O]=null;W[ai][an][ao][w]=false}}ap/=2;ar/=2}Z=am;T=am;var ak=[];var aj=0;al=W[Z].length;aq=W[Z][0].length;for(an=0;an<al;an++){for(ao=0;ao<aq;ao++){ak.push({id:aj++,file:H(Z,an,ao)})}}ak.push({id:aj,file:H(Q,0,0)});k=new ImageLoader({images:ak,onAllLoaded:function(){a()},})}())};